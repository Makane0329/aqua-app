<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Aqua Control Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --rs-red: #ff0033;
            --rs-red-dark: #cc0029;
            --rs-cyan: #00ffff;
            --rs-black: #020617;
            --rs-gray: #111827;
        }
        body {
            background-color: var(--rs-black);
            color: #f8fafc;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif;
            margin: 0;
            padding: 0;
            height: 100dvh;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        .glass {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .active-tab { color: var(--rs-red); }
        .active-tab svg { filter: drop-shadow(0 0 4px var(--rs-red)); }
        
        /* スクロールエリア */
        .content-area {
            height: calc(100dvh - 64px - 64px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
            overflow-y: auto;
            scrollbar-width: none;
        }
        .content-area::-webkit-scrollbar { display: none; }

        .btn-press:active { transform: scale(0.96); transition: transform 0.1s; }
        
        input, select, textarea {
            background: #1f2937;
            border: 1px solid #374151;
            color: white;
            padding: 12px;
            border-radius: 12px;
            outline: none;
        }
        input:focus { border-color: var(--rs-cyan); }

        .card {
            background: linear-gradient(145deg, #111827, #0f172a);
            border: 1px solid #1e293b;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border-radius: 16px;
        }

        /* Modal Animation */
        #modal-container { transition: opacity 0.3s ease; }
        #modal-content { transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
    </style>
</head>
<body class="safe-top safe-bottom">

    <!-- App Header -->
    <header class="px-6 py-4 flex justify-between items-center glass border-b border-white/5 sticky top-0 z-50">
        <div>
            <h1 class="text-xs font-black tracking-[0.2em] text-gray-500 uppercase">Marine System</h1>
            <div class="text-xl font-bold tracking-tighter flex items-center gap-1">
                <span style="color: var(--rs-red);">AQUA</span>
                <span>CONTROL</span>
                <span class="text-[10px] bg-red-600 px-1 rounded text-white ml-1">PRO</span>
            </div>
        </div>
        <div id="tank-name-display" class="text-[10px] text-cyan-400 font-mono bg-cyan-950/30 px-3 py-1 rounded-full border border-cyan-800/50">--</div>
    </header>

    <!-- Main Content -->
    <main id="app-content" class="content-area px-5 py-6">
        <!-- JS injects here -->
    </main>

    <!-- Modal Overlay -->
    <div id="modal-container" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeModal()"></div>
        <div id="modal-content" class="absolute bottom-0 left-0 right-0 glass rounded-t-3xl border-t border-white/10 p-8 transform translate-y-full">
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 glass border-t border-white/5 flex justify-around items-center safe-bottom z-50 h-20">
        <button onclick="router('CHAT')" id="nav-CHAT" class="flex flex-col items-center flex-1 py-2 text-gray-500 btn-press">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg>
            <span class="text-[9px] font-bold mt-1 tracking-widest">CHAT</span>
        </button>
        <button onclick="router('EQUIP')" id="nav-EQUIP" class="flex flex-col items-center flex-1 py-2 text-gray-500 btn-press">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg>
            <span class="text-[9px] font-bold mt-1 tracking-widest">EQUIP</span>
        </button>
        <button onclick="router('LIVES')" id="nav-LIVES" class="flex flex-col items-center flex-1 py-2 text-gray-500 btn-press">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
            <span class="text-[9px] font-bold mt-1 tracking-widest">LIVES</span>
        </button>
        <button onclick="router('LOGS')" id="nav-LOGS" class="flex flex-col items-center flex-1 py-2 text-gray-500 btn-press">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            <span class="text-[9px] font-bold mt-1 tracking-widest">LOGS</span>
        </button>
        <button onclick="router('SET')" id="nav-SET" class="flex flex-col items-center flex-1 py-2 text-gray-500 btn-press">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><circle cx="12" cy="12" r="3"/></svg>
            <span class="text-[9px] font-bold mt-1 tracking-widest">SET</span>
        </button>
    </nav>

    <script>
        const DEFAULT_STATE = {
            settings: { tankName: "30cm Cube", volume: 27 },
            equipment: [
                { id: 1, name: "ReefLED 50", category: "LIGHT", date: "2025-01-10" },
                { id: 2, name: "ライブロック", category: "ROCK", date: "2025-01-10" }
            ],
            lives: [
                { id: 1, name: "カクレクマノミ", category: "FISH", note: "ペア" }
            ],
            logs: [
                { date: "2026-01-20", salinity: 1.023, waterChange: 5 },
                { date: "2026-01-23", salinity: 1.024, waterChange: 0 },
                { date: "2026-01-25", salinity: 1.025, waterChange: 8 }
            ],
            chatHistory: []
        };

        let state = JSON.parse(localStorage.getItem('aqua_pro_v2')) || DEFAULT_STATE;
        let currentPage = 'LOGS';
        const apiKey = "";

        function save() {
            localStorage.setItem('aqua_pro_v2', JSON.stringify(state));
            document.getElementById('tank-name-display').innerText = `${state.settings.tankName} / ${state.settings.volume}L`;
        }

        // --- Custom Modal System ---
        function openModal(contentHtml) {
            const container = document.getElementById('modal-container');
            const content = document.getElementById('modal-content');
            document.getElementById('modal-body').innerHTML = contentHtml;
            container.classList.remove('hidden');
            setTimeout(() => {
                container.style.opacity = '1';
                content.style.transform = 'translateY(0)';
            }, 10);
        }

        function closeModal() {
            const container = document.getElementById('modal-container');
            const content = document.getElementById('modal-content');
            container.style.opacity = '0';
            content.style.transform = 'translateY(100%)';
            setTimeout(() => container.classList.add('hidden'), 300);
        }

        // --- Router ---
        function router(page) {
            currentPage = page;
            render();
            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active-tab'));
            document.getElementById(`nav-${page}`).classList.add('active-tab');
        }

        function render() {
            const container = document.getElementById('app-content');
            container.innerHTML = '';
            switch(currentPage) {
                case 'CHAT': renderChat(container); break;
                case 'EQUIP': renderEquip(container); break;
                case 'LIVES': renderLives(container); break;
                case 'LOGS': renderLogs(container); break;
                case 'SET': renderSettings(container); break;
            }
        }

        // --- Pages ---

        function renderChat(el) {
            el.innerHTML = `
                <div class="flex flex-col h-full relative">
                    <div id="chat-messages" class="flex-1 space-y-6 pb-24">
                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded-full bg-red-600 flex items-center justify-center flex-shrink-0 text-xs font-bold">AI</div>
                            <div class="bg-white/5 p-4 rounded-2xl rounded-tl-none text-sm leading-relaxed border border-white/5">
                                AQUA CONTROL PRO へようこそ。水槽のデータに基づき、最適なメンテナンスプランをご提案します。
                            </div>
                        </div>
                        ${state.chatHistory.map(m => `
                            <div class="flex ${m.role === 'user' ? 'justify-end' : 'justify-start'} gap-3">
                                ${m.role === 'model' ? '<div class="w-8 h-8 rounded-full bg-red-600 flex items-center justify-center flex-shrink-0 text-xs font-bold">AI</div>' : ''}
                                <div class="p-4 rounded-2xl ${m.role === 'user' ? 'bg-red-600 rounded-tr-none' : 'bg-white/5 rounded-tl-none border border-white/5'} text-sm leading-relaxed max-w-[85%]">
                                    ${m.text}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="fixed bottom-24 left-5 right-5 z-40">
                        <div class="glass p-2 rounded-2xl border border-white/10 flex gap-2 shadow-2xl">
                            <input id="chat-input" type="text" class="flex-1 bg-transparent border-none p-3 text-sm" placeholder="AIに相談する...">
                            <button onclick="sendChat()" class="bg-red-600 w-12 h-12 rounded-xl flex items-center justify-center btn-press">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            const box = document.getElementById('chat-messages');
            box.scrollTop = box.scrollHeight;
        }

        async function sendChat() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if(!text) return;
            state.chatHistory.push({ role: 'user', text });
            input.value = '';
            renderChat(document.getElementById('app-content'));

            const systemPrompt = `あなたはマリンアクアリウムの専門家です。
                水槽名: ${state.settings.tankName} (${state.settings.volume}L)
                設備: ${state.equipment.map(e => e.name).join(', ')}
                生体: ${state.lives.map(l => l.name).join(', ')}
                最新ログ: ${JSON.stringify(state.logs.slice(-2))}
                これらに基づき、高級ホテルのコンシェルジュのような丁寧な口調で回答してください。`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });
                const data = await res.json();
                state.chatHistory.push({ role: 'model', text: data.candidates[0].content.parts[0].text });
                save();
                render();
            } catch (e) {
                console.error(e);
            }
        }

        function renderEquip(el) {
            el.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-end">
                        <h2 class="text-2xl font-bold tracking-tight">EQUIPMENT</h2>
                        <span class="text-cyan-400 text-[10px] font-mono mb-1">SYSTEMS ONLINE</span>
                    </div>
                    <div class="grid gap-4">
                        ${state.equipment.map(e => `
                            <div class="card p-4 flex items-center justify-between group">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-white/5 rounded-2xl flex items-center justify-center border border-white/5">
                                        <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                                    </div>
                                    <div>
                                        <div class="font-bold">${e.name}</div>
                                        <div class="text-[10px] text-gray-500 uppercase tracking-widest">${e.category} • ${e.date}</div>
                                    </div>
                                </div>
                                <button onclick="deleteItem('equipment', ${e.id})" class="text-gray-700 hover:text-red-500 p-2 transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="showAddEquipModal()" class="w-full bg-white text-black py-4 rounded-2xl font-bold tracking-widest text-xs btn-press">+ ADD SYSTEM</button>
                </div>
            `;
        }

        function renderLives(el) {
            el.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-end">
                        <h2 class="text-2xl font-bold tracking-tight">LIVES</h2>
                        <span class="text-red-500 text-[10px] font-mono mb-1">BIOTA STATUS</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        ${state.lives.map(l => `
                            <div class="card p-5 relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-red-600/10 rounded-bl-full -mr-8 -mt-8"></div>
                                <div class="text-[9px] text-cyan-400 font-bold mb-1 tracking-tighter opacity-70">${l.category}</div>
                                <div class="font-bold text-lg leading-tight mb-2">${l.name}</div>
                                <div class="text-[10px] text-gray-500">${l.note || 'No notes'}</div>
                                <button onclick="deleteItem('lives', ${l.id})" class="mt-4 text-[10px] text-red-900 font-bold uppercase tracking-widest">Remove</button>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="showAddLiveModal()" class="w-full bg-white text-black py-4 rounded-2xl font-bold tracking-widest text-xs btn-press">+ ADD BIOTA</button>
                </div>
            `;
        }

        function renderLogs(el) {
            const maxSal = 1.030, minSal = 1.020;
            const points = state.logs.slice(-7).map((l, i) => {
                const x = (i / 6) * 100;
                const y = 100 - ((l.salinity - minSal) / (maxSal - minSal) * 100);
                return `${x},${y}`;
            }).join(' ');

            el.innerHTML = `
                <div class="space-y-8">
                    <div class="flex justify-between items-end">
                        <h2 class="text-2xl font-bold tracking-tight">ANALYTICS</h2>
                        <span class="text-gray-500 text-[10px] font-mono mb-1">${new Date().toLocaleDateString()}</span>
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center px-1">
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-widest">Salinity Trace</span>
                            <span class="text-xs text-cyan-400 font-mono">1.020 - 1.030 SG</span>
                        </div>
                        <div class="card p-6 h-40 relative">
                            <svg viewBox="0 0 100 100" preserveAspectRatio="none" class="w-full h-full overflow-visible">
                                <defs>
                                    <linearGradient id="lineGrad" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%" stop-color="var(--rs-cyan)" />
                                        <stop offset="100%" stop-color="transparent" stop-opacity="0" />
                                    </linearGradient>
                                </defs>
                                <path d="M ${points} V 100 H 0 Z" fill="url(#lineGrad)" opacity="0.1" />
                                <path d="M ${points}" fill="none" stroke="var(--rs-cyan)" stroke-width="2" vector-effect="non-scaling-stroke" />
                                ${state.logs.slice(-7).map((l, i) => `
                                    <circle cx="${(i/6)*100}" cy="${100 - ((l.salinity - minSal) / (maxSal - minSal) * 100)}" r="1.5" fill="white" />
                                `).join('')}
                            </svg>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                         <div class="card p-4">
                            <div class="text-[9px] text-gray-500 uppercase font-bold tracking-widest mb-1">Avg Water Change</div>
                            <div class="text-2xl font-bold flex items-baseline gap-1">5.2 <span class="text-xs text-gray-500">L/wk</span></div>
                         </div>
                         <div class="card p-4">
                            <div class="text-[9px] text-gray-500 uppercase font-bold tracking-widest mb-1">Status</div>
                            <div class="text-2xl font-bold text-green-500 flex items-center gap-2">
                                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                Stable
                            </div>
                         </div>
                    </div>

                    <div class="card p-6 space-y-5">
                        <div class="flex justify-between items-center">
                            <h3 class="text-xs font-bold text-cyan-400 uppercase tracking-[0.2em]">Dosing Calculator</h3>
                            <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                        </div>
                        <div class="flex gap-4 items-center">
                            <div class="flex-1">
                                <label class="text-[9px] text-gray-500 block mb-2 font-bold uppercase tracking-widest">Base (ml/10L)</label>
                                <input type="number" id="dose-base" class="w-full text-lg font-bold bg-white/5 border-white/10" value="1.0" step="0.1" oninput="calcDose()">
                            </div>
                            <div class="flex-1 text-right">
                                <label class="text-[9px] text-gray-500 block mb-2 font-bold uppercase tracking-widest">Required Dose</label>
                                <div id="dose-result" class="text-3xl font-black text-red-500">0.0<span class="text-xs ml-1">ml</span></div>
                            </div>
                        </div>
                        <div class="pt-4 border-t border-white/5 flex justify-between items-center">
                            <span class="text-[10px] text-gray-500 uppercase tracking-widest">Equivalent Drops</span>
                            <span id="dose-drops" class="text-lg font-bold text-white font-mono">0</span>
                        </div>
                    </div>

                    <button onclick="showAddLogModal()" class="w-full bg-red-600 py-4 rounded-2xl font-bold tracking-widest text-xs btn-press">NEW LOG ENTRY</button>
                </div>
            `;
            calcDose();
        }

        function calcDose() {
            const base = parseFloat(document.getElementById('dose-base')?.value || 0);
            const resultMl = (state.settings.volume / 10) * base;
            const drops = Math.round(resultMl / 0.05);
            if(document.getElementById('dose-result')) {
                document.getElementById('dose-result').innerHTML = `${resultMl.toFixed(1)}<span class="text-xs ml-1">ml</span>`;
                document.getElementById('dose-drops').innerText = drops;
            }
        }

        function renderSettings(el) {
            el.innerHTML = `
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold tracking-tight uppercase">Settings</h2>
                    <div class="card p-6 space-y-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em] mb-2">Tank Identifier</label>
                                <input type="text" id="set-name" class="w-full" value="${state.settings.tankName}">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em] mb-2">Total Volume (Liters)</label>
                                <input type="number" id="set-vol" class="w-full" value="${state.settings.volume}">
                            </div>
                        </div>
                        <button onclick="updateSettings()" class="w-full bg-cyan-600 py-4 rounded-2xl font-bold tracking-widest text-xs btn-press">SYNC CONFIGURATION</button>
                    </div>

                    <div class="pt-20 text-center">
                        <button onclick="resetData()" class="text-red-900 text-[10px] font-bold uppercase tracking-[0.3em]">Purge System Data</button>
                    </div>
                </div>
            `;
        }

        // --- Action Modals ---

        function showAddEquipModal() {
            openModal(`
                <h3 class="text-xl font-bold mb-6">New Equipment</h3>
                <div class="space-y-4">
                    <input type="text" id="m-name" placeholder="Device Name (e.g. Skimmer)" class="w-full">
                    <select id="m-cat" class="w-full">
                        <option value="LIGHT">LIGHTING</option>
                        <option value="PUMP">WATER FLOW</option>
                        <option value="FILTER">FILTRATION</option>
                        <option value="ROCK">AQUASCAPE</option>
                        <option value="OTHER">OTHERS</option>
                    </select>
                    <button onclick="addEquipAction()" class="w-full bg-red-600 py-4 rounded-xl font-bold mt-4 btn-press">CONFIRM ADD</button>
                </div>
            `);
        }

        function addEquipAction() {
            const name = document.getElementById('m-name').value;
            const cat = document.getElementById('m-cat').value;
            if(!name) return;
            state.equipment.push({ id: Date.now(), name, category: cat, date: new Date().toISOString().split('T')[0] });
            save(); closeModal(); render();
        }

        function showAddLiveModal() {
            openModal(`
                <h3 class="text-xl font-bold mb-6">Add Biota</h3>
                <div class="space-y-4">
                    <input type="text" id="m-name" placeholder="Species Name" class="w-full">
                    <select id="m-cat" class="w-full">
                        <option value="FISH">FISH</option>
                        <option value="CORAL">CORALS</option>
                        <option value="INVERTS">INVERTEBRATES</option>
                    </select>
                    <textarea id="m-note" placeholder="Note..." class="w-full h-24"></textarea>
                    <button onclick="addLiveAction()" class="w-full bg-red-600 py-4 rounded-xl font-bold mt-4 btn-press">ADD TO SYSTEM</button>
                </div>
            `);
        }

        function addLiveAction() {
            const name = document.getElementById('m-name').value;
            const cat = document.getElementById('m-cat').value;
            const note = document.getElementById('m-note').value;
            if(!name) return;
            state.lives.push({ id: Date.now(), name, category: cat, note });
            save(); closeModal(); render();
        }

        function showAddLogModal() {
            openModal(`
                <h3 class="text-xl font-bold mb-6">New Log Entry</h3>
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] font-bold text-gray-500 uppercase mb-1 block">Salinity (SG)</label>
                        <input type="number" id="m-sal" step="0.001" value="1.024" class="w-full">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-gray-500 uppercase mb-1 block">Water Change (L)</label>
                        <input type="number" id="m-wc" value="0" class="w-full">
                    </div>
                    <button onclick="addLogAction()" class="w-full bg-red-600 py-4 rounded-xl font-bold mt-4 btn-press">RECORD DATA</button>
                </div>
            `);
        }

        function addLogAction() {
            const sal = parseFloat(document.getElementById('m-sal').value);
            const wc = parseFloat(document.getElementById('m-wc').value);
            state.logs.push({ date: new Date().toISOString().split('T')[0], salinity: sal, waterChange: wc });
            save(); closeModal(); render();
        }

        // --- Utils ---
        function updateSettings() {
            state.settings.tankName = document.getElementById('set-name').value;
            state.settings.volume = parseFloat(document.getElementById('set-vol').value);
            save();
            render();
            // Show custom mini-toast instead of alert if possible, but alert is fine for now
            alert('CONFIGURATION UPDATED');
        }

        function deleteItem(type, id) {
            state[type] = state[type].filter(i => i.id !== id);
            save(); render();
        }

        function resetData() {
            if(confirm('SYSTEM PURGE: Are you sure?')) {
                localStorage.clear();
                location.reload();
            }
        }

        window.onload = () => {
            router('LOGS');
            save();
        };
    </script>
</body>
</html>
